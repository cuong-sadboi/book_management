<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Add User | Book Management</title>
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-light d-flex flex-column min-vh-100">
	<div id="navbarInclude" data-include="../include/navbar.html"></div>
	<div class="layout-wrapper">
		<div id="sidebarInclude" data-include="../include/sidebar.html"></div>
		<div class="sidebar-backdrop" id="sidebarBackdrop"></div>
		<main class="content-area">
			<div class="container">
				<div class="card shadow-sm border-0">
					<div class="card-header bg-white border-0 pb-0">
						<h2 class="h4 mb-0">Add new user</h2>
					</div>
					<div class="card-body">
						<form id="userForm" class="row g-3">
							<div class="col-md-6">
								<label for="name" class="form-label">Name </label>
								<input type="text" id="name" name="name" class="form-control" required>
							</div>
							<div class="col-md-6">
								<label for="username" class="form-label">Username </label>
								<input type="text" id="username" name="username" class="form-control" required>
							</div>
							<div class="col-md-6">
								<label for="email" class="form-label">Email </label>
								<input type="email" id="email" name="email" class="form-control" required>
							</div>
							<div class="col-md-6">
								<label for="age" class="form-label">Age</label>
								<input type="number" id="age" name="age" class="form-control" min="1" max="150">
							</div>
							<div class="col-12">
								<label for="location" class="form-label">Location</label>
								<input type="text" id="location" name="location" class="form-control" placeholder="e.g., Hanoi, Vietnam">
							</div>
							<div class="col-12">
								<label for="bio" class="form-label">Note</label>
								<textarea id="bio" name="bio" rows="4" class="form-control" placeholder="Short note..."></textarea>
							</div>
							<div class="col-12 d-flex justify-content-end gap-2 pt-3">
								<a href="index-user.html" class="btn btn-outline-secondary">Cancel</a>
								<button type="submit" class="btn btn-primary">Save user</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</main>
	</div>
	<div id="footerInclude" class="layout-footer" data-include="../include/footer.html"></div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	<script src="js/utils.js"></script>
	<script src="js/layout.js"></script>
	<script>
		(() => {
			const form = document.getElementById('userForm');
			form.addEventListener('submit', async (event) => {
				event.preventDefault();
				const btn = form.querySelector('button[type="submit"]');
				const original = btn.textContent;
				btn.disabled = true; btn.textContent = 'Saving...';
				try {
					const payload = {
						name: form.name.value.trim(),
						username: form.username.value.trim(),
						email: form.email.value.trim(),
						age: form.age.value ? Number(form.age.value) : null,
						location: form.location.value.trim(),
						bio: form.bio.value.trim(),
					};
					const res = await fetch('api/users.php', {
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify(payload),
					});
					const data = await res.json();
					if (!res.ok || data?.error) throw new Error(data?.error || 'Unable to save.');
					window.location.href = 'index-user.html?created=1';
				} catch (err) {
					alert(err.message || 'An unexpected error occurred.');
				} finally {
					btn.disabled = false; btn.textContent = original;
				}
			});
		})();
	</script>
</body>
</html>
